<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
<f:metadata>
    <f:event type="preRenderView" listener="#{login_bean.checkAuthentication}" />
</f:metadata>
<h:head>
    <title>Documento Clínico</title>
    <meta charset="UTF-8" />
    <style>
        .viewer { width: 100%; height: 85vh; border: none; }
    </style>
    <meta name="robots" content="noindex,nofollow"/>
    <meta http-equiv="X-Content-Security-Policy" content="default-src 'self'; frame-ancestors 'self'" />
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; frame-ancestors 'self'" />
    <meta http-equiv="X-Frame-Options" content="SAMEORIGIN" />
    <meta http-equiv="X-Content-Type-Options" content="nosniff" />
</h:head>
<h:body>
    <h:form id="formDoc">
        <p:menubar>
            <p:menuitem value="Volver" icon="pi pi-arrow-left" outcome="/usuario/historia_lista" />
            <p:menuitem value="Salir" icon="pi pi-sign-out" action="#{login_bean.logout}" />
        </p:menubar>

        <p:panel header="Documento Clínico">
            <h:panelGroup rendered="#{not empty historia_doc_bean.pdfBase64}">
                <object class="viewer" type="application/pdf"
                        data="#{'data:application/pdf;base64,'.concat(historia_doc_bean.pdfBase64)}">
                    <h:outputLink value="#{'data:application/pdf;base64,'.concat(historia_doc_bean.pdfBase64)}">Descargar PDF</h:outputLink>
                </object>
            </h:panelGroup>
            <h:panelGroup rendered="#{empty historia_doc_bean.pdfBase64}">
                <h:panelGroup rendered="#{not empty historia_doc_bean.htmlDataUrl}">
                    <iframe class="viewer" sandbox="" src="#{historia_doc_bean.htmlDataUrl}"></iframe>
                </h:panelGroup>
                <h:panelGroup rendered="#{empty historia_doc_bean.htmlDataUrl}">
                    <p:message for="formDoc" severity="error"/>
                    <h:outputText value="No se pudo obtener el documento en PDF ni HTML." />
                </h:panelGroup>
            </h:panelGroup>
        </p:panel>
    </h:form>
</h:body>
</html>


