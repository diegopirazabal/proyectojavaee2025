<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="jakarta.faces.html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="jakarta.faces.core">

<h:head>
    <meta charset="UTF-8"/>
    <title>Configuración - Portal Admin Clínica</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <h:outputStylesheet library="css" name="admin-theme.css"/>
    <style>
        :root {
            --primary-color: #{empty lookAndFeelBean.colorPrimario ? '#007bff' : lookAndFeelBean.colorPrimario};
            --secondary-color: #{empty lookAndFeelBean.colorSecundario ? '#6c757d' : lookAndFeelBean.colorSecundario};
        }
        .color-preview {
            width: 50px;
            height: 30px;
            border: 1px solid #ccc;
            display: inline-block;
            margin-left: 10px;
            vertical-align: middle;
        }
    </style>
</h:head>

<f:metadata>
    <f:event type="preRenderView" listener="#{sessionBean.checkAuth()}"/>
</f:metadata>

<h:body>
    <h:form>
        <p:menubar>
            <p:menuitem value="Dashboard" icon="pi pi-home" outcome="/pages/dashboard.xhtml"/>
            <p:menuitem value="Usuarios" icon="pi pi-user" outcome="/pages/usuarios.xhtml"/>
            <p:menuitem value="Profesionales" icon="pi pi-users" outcome="/pages/profesionales.xhtml"/>
            <p:menuitem value="Configuración" icon="pi pi-cog" outcome="/pages/configuracion.xhtml"/>

            <f:facet name="options">
                <p:outputLabel value="#{sessionBean.nombreAdministrador}" style="margin-right: 1rem; color: white; font-weight: bold;"/>
                <p:commandButton value="Cerrar Sesión"
                                icon="pi pi-sign-out"
                                action="#{sessionBean.logout}"
                                styleClass="btn-secundario"/>
            </f:facet>
        </p:menubar>
    </h:form>

    <div class="page-container">
        <h:form id="configuracionForm">
            <p:messages id="messages" showDetail="false" closable="true"/>

            <!-- Panel Look & Feel -->
            <p:panel header="Personalización de Look &amp; Feel" style="margin-bottom: 2rem;">
                <p:panelGrid columns="2" layout="grid" styleClass="p-fluid">
                    <p:outputLabel for="colorPrimario" value="Color Primario"/>
                    <div>
                        <p:inputText id="colorPrimario"
                                    value="#{configuracionBean.colorPrimario}"
                                    placeholder="#007bff"/>
                        <span class="color-preview"
                              style="background-color: #{configuracionBean.colorPrimario};"/>
                        <small class="p-d-block">Formato hexadecimal (#RRGGBB)</small>
                    </div>

                    <p:outputLabel for="colorSecundario" value="Color Secundario"/>
                    <div>
                        <p:inputText id="colorSecundario"
                                    value="#{configuracionBean.colorSecundario}"
                                    placeholder="#6c757d"/>
                        <span class="color-preview"
                              style="background-color: #{configuracionBean.colorSecundario};"/>
                        <small class="p-d-block">Formato hexadecimal (#RRGGBB)</small>
                    </div>

                    <p:outputLabel for="nombreSistema" value="Nombre del Sistema"/>
                    <p:inputText id="nombreSistema"
                                value="#{configuracionBean.nombreSistema}"
                                placeholder="Sistema de Gestión Clínica"/>

                    <p:outputLabel for="logoUrl" value="URL del Logo"/>
                    <p:inputText id="logoUrl"
                                value="#{configuracionBean.logoUrl}"
                                placeholder="https://ejemplo.com/logo.png"/>

                    <p:outputLabel for="tema" value="Tema"/>
                    <p:selectOneMenu id="tema" value="#{configuracionBean.tema}">
                        <f:selectItem itemLabel="Por defecto" itemValue="default"/>
                        <f:selectItem itemLabel="Saga" itemValue="saga"/>
                        <f:selectItem itemLabel="Vela" itemValue="vela"/>
                        <f:selectItem itemLabel="Arya" itemValue="arya"/>
                    </p:selectOneMenu>
                </p:panelGrid>

                <f:facet name="footer">
                    <p:commandButton id="guardarBtn"
                                    value="Guardar Cambios"
                                    icon="pi pi-check"
                                    action="#{configuracionBean.guardarLookAndFeel}"
                                    update=":configuracionForm:messages,:configuracionForm"
                                    styleClass="btn-primario"
                                    oncomplete="location.reload();"/>
                    <small style="margin-left: 1rem; color: #666;">
                        Nota: Los cambios de color se aplicarán después de guardar y recargar la página.
                    </small>
                    <p:commandButton value="Restablecer Valores por Defecto"
                                    icon="pi pi-refresh"
                                    action="#{configuracionBean.resetearConfiguracion}"
                                    update=":configuracionForm:messages,:configuracionForm"
                                    styleClass="btn-secundario"
                                    style="margin-left: 0.5rem;"
                                    oncomplete="location.reload();">
                        <p:confirm header="Confirmar"
                                  message="¿Está seguro de restablecer la configuración a valores por defecto?"
                                  icon="pi pi-exclamation-triangle"/>
                    </p:commandButton>
                </f:facet>
            </p:panel>

            <!-- Panel Integración -->
            <p:panel header="Configuración de Integración">
                <h:panelGrid columns="2" style="margin-bottom: 1rem;">
                    <h:outputText value="ID de Clínica (Tenant ID):"/>
                    <h:outputText value="#{sessionBean.tenantId}" style="font-weight: bold;"/>

                    <h:outputText value="Estado Nodo Periférico:"/>
                    <h:outputText value="#{configuracionBean.nodoPerifericoHabilitado ? 'Habilitado' : 'Deshabilitado'}"
                                 style="font-weight: bold; color: #{configuracionBean.nodoPerifericoHabilitado ? 'green' : 'red'};"/>
                </h:panelGrid>

                <p:separator/>

                <div style="margin-top: 1rem;">
                    <h4>Configuración de Nodo Periférico</h4>
                    <p style="color: #666;">
                        Habilita la conexión de esta clínica con el componente central de HCEN para compartir
                        información clínica con otras instituciones del sistema de salud nacional.
                    </p>

                    <p:selectBooleanCheckbox id="nodoPeriferico"
                                            value="#{configuracionBean.nodoPerifericoHabilitado}"
                                            itemLabel="Habilitar como nodo periférico"/>

                    <p:commandButton value="Aplicar Configuración de Nodo"
                                    icon="pi pi-save"
                                    action="#{configuracionBean.toggleNodoPeriferico}"
                                    update=":configuracionForm:messages,:configuracionForm"
                                    styleClass="p-button-primary"
                                    style="margin-top: 1rem;"/>
                </div>
            </p:panel>

            <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
                <p:commandButton value="Sí" styleClass="ui-confirmdialog-yes" icon="pi pi-check" process="@this"/>
                <p:commandButton value="No" styleClass="ui-confirmdialog-no" icon="pi pi-times" process="@this"/>
            </p:confirmDialog>
        </h:form>
    </div>
</h:body>
</html>
